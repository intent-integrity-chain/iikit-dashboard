# Implementation Plan: Bugs Tab — Bug Tracking Visualization

**Branch**: `009-bugs-tab` | **Date**: 2026-02-19 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/009-bugs-tab/spec.md`

## Summary

Add a Bugs tab to the dashboard pipeline bar that visualizes data from `/iikit-bugfix`. The tab is standalone (no connector line), shows an open bug count badge color-coded by severity, and opens a bug status table with severity indicators, fix task progress, GitHub issue links, and status tracking. Bug fix tasks on the Implement board get a bug icon and cross-panel navigation links connect both views.

Technical approach: follow the existing view pattern — new `src/bugs.js` server-side module, REST endpoint, WebSocket broadcast, and frontend rendering in `index.html`. Extend `parseTasks` to recognize `T-B` prefixed tasks. New `parseBugs` function for `bugs.md` parsing.

## Technical Context

**Language/Version**: JavaScript (Node.js >=18.0.0)
**Primary Dependencies**: Express 5.2.1, ws 8.19.0, chokidar 3.6.0 (all existing)
**Storage**: Filesystem — reads `bugs.md` and `tasks.md` from `specs/<feature>/`
**Testing**: Jest 30.2.0 (unit), Playwright 1.58.2 (visual)
**Target Platform**: Browser (all modern) + Node.js server
**Project Type**: Web application (single-file frontend + Express backend)
**Performance Goals**: Bug table renders in <2 seconds (SC-001), WebSocket updates within existing latency window (SC-006)
**Constraints**: No new dependencies (Constitution §IV — simplicity). No build step (inline JS/CSS pattern).
**Scale/Scope**: Typically <50 bugs per feature, <200 fix tasks

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| §I Test-First Development | PASS | Per constitution: TDD mandatory. Tests will be generated by `/iikit-05-testify` before implementation. |
| §II Real-Time Accuracy | PASS | Bug data derived from disk artifacts via existing chokidar watcher. WebSocket broadcasts bug state on file change. |
| §III Professional Kanban UI | PASS | Bug table follows existing dashboard visual patterns: CSS custom properties, severity color coding, clean typography. |
| §IV Simplicity | PASS | No new dependencies. Extends existing parsers. Single new module. Follows established view pattern exactly. |
| Quality Standards | PASS | Tests before code. Acceptance criteria defined in spec. ARIA labels on all interactive elements. |

## Project Structure

### Documentation (this feature)

```text
specs/009-bugs-tab/
  spec.md              # Feature specification
  plan.md              # This file
  research.md          # Technology decisions
  data-model.md        # Bug and FixTask entities
  quickstart.md        # Test scenarios
  contracts/           # API contracts
    bugs-api.md        # GET /api/bugs/:feature
  tasks.md             # Task breakdown (created by /iikit-06-tasks)
```

### Source Code (repository root)

```text
src/
  bugs.js              # NEW — computeBugsState() server-side module
  parser.js            # MODIFY — add parseBugs(), extend parseTasks regex
  server.js            # MODIFY — add GET /api/bugs/:feature, WebSocket bugs_update
  public/
    index.html         # MODIFY — Bugs tab, renderBugsView(), badge, cross-links, bug icon

test/
  bugs.test.js         # NEW — unit tests for parseBugs, computeBugsState
  parser.test.js       # MODIFY — add parseBugs tests, extend parseTasks tests
  server.test.js       # MODIFY — add /api/bugs endpoint tests
```

**Structure Decision**: Follows the existing single-project structure with co-located server modules in `src/` and tests in `test/`. New `src/bugs.js` mirrors the pattern of `src/checklist.js`, `src/analyze.js`, etc. No additional directories needed.

## Architecture

### Parser Extension (FR-003, FR-005)

The existing `parseTasks` regex (`/- \[([ x])\] (T\d+)\s+(?:\[P\]\s*)?(?:\[(US\d+)\]\s*)?(.*)/g`) only matches `T\d+` task IDs and `[US\d+]` story tags. Bug fix tasks use `T-B\d+` IDs and `[BUG-\d+]` tags.

**Decision**: Extend the regex to handle both formats:
```
/- \[([ x])\] (T(?:-B)?\d+)\s+(?:\[P\]\s*)?(?:\[(US\d+|BUG-\d+)\]\s*)?(.*)/g
```

This adds:
- `T(?:-B)?\d+` — matches both `T001` and `T-B001`
- `(US\d+|BUG-\d+)` — captures both `[US1]` and `[BUG-001]` tags
- `isBugFix` boolean derived from ID prefix (`T-B`)
- `bugTag` field populated when tag matches `BUG-\d+`

### New Parser: parseBugs (FR-003)

Parses `bugs.md` using the template format produced by `/iikit-bugfix`:

```
## BUG-NNN
**Reported**: YYYY-MM-DD
**Severity**: critical | high | medium | low
**Status**: reported | fixed
**GitHub Issue**: #number or _(none)_
**Description**: text
```

Returns an array of bug objects. Permissive parsing — returns `[]` on missing/empty/malformed content.

### Server Module: src/bugs.js (FR-005, FR-011)

`computeBugsState(projectPath, featureId)` reads both `bugs.md` and `tasks.md`, cross-references fix tasks by `[BUG-NNN]` tag, and returns:

```json
{
  "exists": true,
  "bugs": [
    {
      "id": "BUG-001",
      "reported": "2026-02-19",
      "severity": "critical",
      "status": "reported",
      "githubIssue": "#13",
      "description": "Login fails with plus sign in email",
      "fixTasks": {
        "total": 3,
        "checked": 1,
        "tasks": [
          { "id": "T-B001", "description": "Investigate root cause...", "checked": false },
          { "id": "T-B002", "description": "Implement fix...", "checked": true },
          { "id": "T-B003", "description": "Write regression test...", "checked": false }
        ]
      }
    }
  ],
  "summary": {
    "total": 3,
    "open": 2,
    "fixed": 1,
    "highestOpenSeverity": "critical",
    "bySeverity": { "critical": 1, "high": 0, "medium": 1, "low": 1 }
  }
}
```

### Board Enhancement (FR-006)

Bug fix tasks (with `isBugFix: true`) are grouped into per-bug cards on the Implement board instead of the generic "Unassigned" card. Each bug card:
- Shows the BUG-NNN ID as the card title
- Displays a bug icon
- Lists its T-B fix tasks with progress
- The BUG-NNN tag is a cross-link to the Bugs tab

### Pipeline Bar: Standalone Tab (FR-001, FR-002, FR-009, FR-010)

The Bugs tab is NOT a pipeline phase. It is rendered as a separate element after the phase chain, with no connector line. It follows a distinct visual treatment:
- Positioned at the end of the pipeline bar with a gap (no connector)
- Shows a count badge (colored by highest open severity)
- Muted when no bugs exist

### WebSocket Integration (FR-008, SC-006)

The existing chokidar watcher already fires on any file change in the project directory. The debounced handler is extended to compute and broadcast `bugs_update` alongside existing view updates:

```json
{ "type": "bugs_update", "feature": "009-bugs-tab", "bugs": { ... } }
```

The pipeline update also includes bug count data so the tab badge updates.

### Cross-Panel Navigation (FR-007, SC-005)

Uses the existing delegated `data-cross-target` / `data-cross-id` pattern:

| Source | Element | Target | Entity |
|--------|---------|--------|--------|
| Bugs tab | Task ID (T-B001) | `implement` | T-B001 |
| Bugs tab | GitHub Issue (#13) | External link | New tab |
| Implement board | BUG-NNN tag | `bugs` | BUG-001 |

New highlighter: `highlightBugsEntity(entityId)` — finds `[data-bug-id="BUG-001"]` row, scrolls into view, applies 2-second highlight animation.

### GitHub URL Resolution (FR-012)

`resolveGitHubIssueUrl(issueRef, repoUrl)` converts issue references like `"#13"` to full clickable URLs. The repo URL is derived server-side from `git remote get-url origin`, stripping the `.git` suffix. If no remote is configured, returns `null` and the frontend renders the reference as plain text.

Example: remote `https://github.com/user/repo.git` + issue `#13` → `https://github.com/user/repo/issues/13`.

### CSS Additions (FR-004, SC-007)

All new styles use existing CSS custom properties. New severity color mappings:

| Severity | Color Variable | Value |
|----------|---------------|-------|
| critical | `--color-p1` | `#ff4757` (red) |
| high | `--color-p2` | `#ffa502` (orange) |
| medium | `--color-p3` | `#3498db` → remap to yellow `#f1c40f` for bugs |
| low | `--color-missing` | `#6b7189` (gray) |

Note: The spec defines medium=yellow, but the existing `--color-p3` is blue. The bug severity palette uses dedicated CSS classes (`.severity-critical`, `.severity-high`, `.severity-medium`, `.severity-low`) with explicit colors matching the spec.

## Complexity Tracking

> No constitution violations to justify. All decisions follow existing patterns.
